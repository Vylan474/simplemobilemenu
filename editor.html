<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>MyMobileMenu - Restaurant Menu Editor</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="accessibility-fixes.css">
    <style>
        .auth-form { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .error-message { color: #e74c3c; margin: 10px 0; font-size: 14px; }
        .auth-switch { text-align: center; margin-top: 15px; }
        .auth-switch a { color: #3498db; text-decoration: none; }
        .auth-switch a:hover { text-decoration: underline; }
        
        .auth-divider { 
            margin: 20px 0; 
            text-align: center; 
            position: relative; 
            color: #999; 
        }
        .auth-divider:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
        }
        .auth-divider span {
            background: white;
            padding: 0 15px;
            position: relative;
        }
        
        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            padding: 12px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            color: #444;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 15px;
        }
        .google-signin-btn:hover {
            border-color: #4285f4;
            background: #f8f9ff;
            color: #4285f4;
        }
        .google-signin-btn i {
            font-size: 18px;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&family=Lato:wght@300;400;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Database Authentication (Firebase removed) -->
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <nav id="sidebar" class="sidebar" role="navigation" aria-label="Menu management">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="user-name" aria-label="Current user">Demo User</div>
                        <div class="user-email" id="user-email" aria-label="User email">demo@example.com</div>
                    </div>
                </div>
                <button id="close-sidebar" class="sidebar-close" aria-label="Close sidebar menu">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="sidebar-content">
                <div class="sidebar-section">
                    <div class="section-header" id="menus-section-header">
                        <i class="fas fa-utensils"></i>
                        <span>My Menus</span>
                        <i class="fas fa-chevron-down section-toggle"></i>
                    </div>
                    <div class="section-content" id="menus-list">
                        <!-- Menu items will be populated here -->
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="section-header" id="settings-section-header">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </div>
                    <div class="section-content" id="settings-list">
                        <div class="setting-item" id="dark-mode-toggle">
                            <i class="fas fa-moon"></i>
                            <span>Dark Mode</span>
                            <div class="toggle-switch">
                                <input type="checkbox" id="dark-mode-checkbox">
                                <label for="dark-mode-checkbox" class="slider"></label>
                            </div>
                        </div>
                        <div class="setting-item">
                            <i class="fas fa-bell"></i>
                            <span>Notifications</span>
                        </div>
                    </div>
                </div>
                
                <div class="sidebar-footer">
                    <div class="setting-item" id="sign-out-item">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Sign Out</span>
                    </div>
                    <div class="system-updated-info">
                        <i class="fas fa-code-branch"></i>
                        <div class="system-updated-details">
                            <div class="system-updated-label">Last System Update</div>
                            <div class="system-updated-time" id="system-updated-time">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay" class="sidebar-overlay"></div>
        
        <!-- Main Content -->
        <div class="main-layout">
            <header class="header" role="banner">
                <div class="header-left">
                    <button id="toggle-sidebar" class="btn btn-secondary sidebar-toggle" aria-label="Toggle sidebar menu" aria-expanded="false">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1><img src="Logos/logo_side_by_side.png" alt="MyMobileMenu logo - Restaurant menu editor" style="height: 28px; vertical-align: middle;"></h1>
                    <div class="current-menu-info" role="status" aria-live="polite">
                        <span class="current-menu-name" id="current-menu-name">My Restaurant Menu</span>
                        <div class="menu-status-row">
                            <span class="menu-status" id="menu-status">Draft</span>
                            <span class="change-indicator" id="change-indicator">
                                <i class="fas fa-circle"></i> Saved
                            </span>
                        </div>
                    </div>
                </div>
                <div class="header-controls">
                    <div class="save-controls">
                        <button id="save-menu" class="btn btn-primary" aria-label="Save current menu changes">
                            <i class="fas fa-save"></i> Save Menu
                        </button>
                        <button id="discard-changes" class="btn btn-warning"  aria-label="Discard unsaved changes">
                            <i class="fas fa-undo"></i> Discard
                        </button>
                    </div>
                    <button id="export-menu" class="btn btn-secondary" aria-label="Export menu to file">
                        <i class="fas fa-download"></i> Export
                    </button>
                    <button id="import-menu" class="btn btn-secondary" aria-label="Import menu from file">
                        <i class="fas fa-upload"></i> Import
                    </button>
                    <input type="file" id="import-file" accept=".json" >
                </div>
            </header>

            <div id="toolbar" class="toolbar" role="toolbar" aria-label="Menu editing tools">
                <div class="primary-actions">
                    <button id="add-section" class="btn btn-primary" aria-label="Add new menu section">
                        <i class="fas fa-plus"></i> Add Section
                    </button>
                    <button id="show-welcome" class="btn btn-secondary" aria-label="Show welcome tour again">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                </div>
                <div class="logo-controls">
                    <button id="logo-options" class="btn btn-secondary" aria-label="Logo options and upload" aria-expanded="false" aria-haspopup="true">
                        <i class="fas fa-image"></i> Logo
                    </button>
                    <div id="logo-dropdown" class="dropdown logo-dropdown" >
                        <div class="logo-section">
                            <label>Upload Logo:</label>
                            <div class="logo-upload-area">
                                <div id="logo-preview-thumbnail" class="logo-thumbnail" >
                                    <img src="" alt="Logo preview">
                                    <button id="remove-logo-thumb" class="remove-thumbnail-btn" aria-label="Remove uploaded logo">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <button id="upload-logo" class="btn btn-primary btn-small">
                                    <i class="fas fa-upload"></i> Choose Logo
                                </button>
                                <div class="logo-recommendations" style="font-size: 11px; color: #666; margin-top: 8px; line-height: 1.4;">
                                    <small>Recommended: 300×150px (landscape) or 200×200px (square)</small><br>
                                    <small>Max 2MB • Formats: PNG, JPG, SVG, WEBP</small>
                                </div>
                            </div>
                        </div>
                        <div class="logo-section" id="logo-size-section" >
                            <label>Logo Size:</label>
                            <div class="logo-size-options">
                                <button class="dropdown-option size-option" data-size="small">
                                    <i class="fas fa-compress"></i>
                                    <span>Small</span>
                                    <small>45% width</small>
                                </button>
                                <button class="dropdown-option size-option active" data-size="medium">
                                    <i class="fas fa-expand-alt"></i>
                                    <span>Medium</span>
                                    <small>60% width</small>
                                </button>
                                <button class="dropdown-option size-option" data-size="large">
                                    <i class="fas fa-expand"></i>
                                    <span>Large</span>
                                    <small>75% width</small>
                                </button>
                            </div>
                        </div>
                    </div>
                    <input type="file" id="logo-file-input" accept="image/png,image/jpeg,image/jpg,image/gif,image/svg+xml,image/webp" >
                </div>
                <div class="background-controls">
                    <button id="background-options" class="btn btn-secondary" aria-label="Background customization options" aria-expanded="false" aria-haspopup="true">
                        <i class="fas fa-palette"></i> Background
                    </button>
                    <div id="background-dropdown" class="dropdown background-dropdown" >
                        <div class="background-section">
                            <label>Background Images:</label>
                            <div class="background-image-grid">
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Charcoal Linen.png">
                                    <img src="Background Images/Charcoal Linen.png" alt="Charcoal Linen">
                                    <span>Charcoal Linen</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Ivory Weave.png">
                                    <img src="Background Images/Ivory Weave.png" alt="Ivory Weave">
                                    <span>Ivory Weave</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Textured Parchment.png">
                                    <img src="Background Images/Textured Parchment.png" alt="Textured Parchment">
                                    <span>Textured Parchment</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Cloud Nine.png">
                                    <img src="Background Images/Cloud Nine.png" alt="Cloud Nine">
                                    <span>Cloud Nine</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Digital Depths.png">
                                    <img src="Background Images/Digital Depths.png" alt="Digital Depths">
                                    <span>Digital Depths</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Electric Tide.png">
                                    <img src="Background Images/Electric Tide.png" alt="Electric Tide">
                                    <span>Electric Tide</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Midnight Storm.png">
                                    <img src="Background Images/Midnight Storm.png" alt="Midnight Storm">
                                    <span>Midnight Storm</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Neon Pulse.png">
                                    <img src="Background Images/Neon Pulse.png" alt="Neon Pulse">
                                    <span>Neon Pulse</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Ocean Breeze.png">
                                    <img src="Background Images/Ocean Breeze.png" alt="Ocean Breeze">
                                    <span>Ocean Breeze</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Royal Amethyst.png">
                                    <img src="Background Images/Royal Amethyst.png" alt="Royal Amethyst">
                                    <span>Royal Amethyst</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Silver Mist.png">
                                    <img src="Background Images/Silver Mist.png" alt="Silver Mist">
                                    <span>Silver Mist</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Slate Ridge.png">
                                    <img src="Background Images/Slate Ridge.png" alt="Slate Ridge">
                                    <span>Slate Ridge</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Starlight Navy.png">
                                    <img src="Background Images/Starlight Navy.png" alt="Starlight Navy">
                                    <span>Starlight Navy</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Sunset Flame.png">
                                    <img src="Background Images/Sunset Flame.png" alt="Sunset Flame">
                                    <span>Sunset Flame</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="image" data-value="Background Images/Warm Ash.png">
                                    <img src="Background Images/Warm Ash.png" alt="Warm Ash">
                                    <span>Warm Ash</span>
                                </div>
                                <div class="dropdown-option background-option" data-type="none" data-value="none">
                                    <div class="no-background">
                                        <i class="fas fa-ban"></i>
                                    </div>
                                    <span>None</span>
                                </div>
                            </div>
                        </div>
                        <div class="background-section" id="recent-backgrounds-section" >
                            <label>Recent Uploads:</label>
                            <div class="recent-backgrounds-grid" id="recent-backgrounds-grid">
                                <!-- Recent backgrounds will be loaded here -->
                            </div>
                        </div>
                        <div class="background-section">
                            <label>Upload Custom Image:</label>
                            <div class="custom-upload-section">
                                <div class="upload-info">
                                    <small>Recommended: 1080×1920px (mobile) or 1200×1600px</small>
                                    <small>Portrait orientation works best for menu scrolling</small>
                                    <small>Formats: JPG, PNG, WEBP (max 5MB)</small>
                                </div>
                                <div class="upload-controls">
                                    <input type="file" id="background-upload" accept="image/jpeg,image/png,image/webp" >
                                    <button type="button" id="upload-background-btn" class="btn btn-primary btn-small" style="pointer-events: auto; cursor: pointer;" onclick="document.getElementById('background-upload').click();">
                                        <i class="fas fa-upload"></i> Choose Image
                                    </button>
                                    <span id="upload-filename" class="upload-filename"></span>
                                </div>
                                <div id="upload-preview" class="upload-preview" >
                                    <img id="upload-preview-img" alt="Preview">
                                    <button id="use-uploaded-background" class="btn btn-success btn-small">
                                        <i class="fas fa-check"></i> Use This Image
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="background-section">
                            <label>Background Color:</label>
                            <div class="color-picker-group">
                                <input type="color" id="background-color-picker" value="#ffffff">
                                <button id="use-color-background" class="btn btn-small">Use Color</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="font-controls">
                    <button id="font-options" class="btn btn-secondary" aria-label="Font family options" aria-expanded="false" aria-haspopup="true">
                        <i class="fas fa-font"></i> Font
                    </button>
                    <div id="font-dropdown" class="dropdown font-dropdown" >
                        <div class="font-section">
                            <label>Font Family:</label>
                            <div class="font-family-grid">
                                <div class="dropdown-option font-option" data-font="Inter">
                                    <span style="font-family: Inter, sans-serif;">Inter</span>
                                    <small>Modern & Clean</small>
                                </div>
                                <div class="dropdown-option font-option" data-font="Playfair Display">
                                    <span style="font-family: 'Playfair Display', serif;">Playfair Display</span>
                                    <small>Elegant & Upscale</small>
                                </div>
                                <div class="dropdown-option font-option" data-font="Georgia">
                                    <span style="font-family: Georgia, serif;">Georgia</span>
                                    <small>Classic & Traditional</small>
                                </div>
                                <div class="dropdown-option font-option" data-font="Lato">
                                    <span style="font-family: Lato, sans-serif;">Lato</span>
                                    <small>Friendly & Approachable</small>
                                </div>
                                <div class="dropdown-option font-option" data-font="Montserrat">
                                    <span style="font-family: Montserrat, sans-serif;">Montserrat</span>
                                    <small>Bold & Impactful</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="color-controls">
                    <button id="color-options" class="btn btn-secondary" aria-label="Color palette options" aria-expanded="false" aria-haspopup="true">
                        <i class="fas fa-swatchbook"></i> Colors
                    </button>
                    <div id="color-dropdown" class="dropdown color-dropdown" >
                        <div class="color-section">
                            <label>Color Palettes:</label>
                            <div class="color-palette-grid">
                                <div class="palette-option" data-palette="classic">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #2c3e50;"></div>
                                        <div class="color-swatch" style="background-color: #7f8c8d;"></div>
                                        <div class="color-swatch" style="background-color: #34495e;"></div>
                                        <div class="color-swatch" style="background-color: #27ae60;"></div>
                                        <div class="color-swatch" style="background-color: #ecf0f1;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Classic</span>
                                        <small>Timeless elegance</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="ocean">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #1e3a5f;"></div>
                                        <div class="color-swatch" style="background-color: #5a6c7d;"></div>
                                        <div class="color-swatch" style="background-color: #2c5282;"></div>
                                        <div class="color-swatch" style="background-color: #3182ce;"></div>
                                        <div class="color-swatch" style="background-color: #ebf8ff;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Ocean</span>
                                        <small>Fresh blues & teals</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="forest">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #1a202c;"></div>
                                        <div class="color-swatch" style="background-color: #4a5568;"></div>
                                        <div class="color-swatch" style="background-color: #2d3748;"></div>
                                        <div class="color-swatch" style="background-color: #38a169;"></div>
                                        <div class="color-swatch" style="background-color: #f0fff4;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Forest</span>
                                        <small>Natural greens & earth tones</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="sunset">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #742a2a;"></div>
                                        <div class="color-swatch" style="background-color: #a0616a;"></div>
                                        <div class="color-swatch" style="background-color: #9c2a2a;"></div>
                                        <div class="color-swatch" style="background-color: #e53e3e;"></div>
                                        <div class="color-swatch" style="background-color: #fffaf0;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Sunset</span>
                                        <small>Warm oranges & reds</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="monochrome">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #1a1a1a;"></div>
                                        <div class="color-swatch" style="background-color: #4a4a4a;"></div>
                                        <div class="color-swatch" style="background-color: #2d2d2d;"></div>
                                        <div class="color-swatch" style="background-color: #000000;"></div>
                                        <div class="color-swatch" style="background-color: #f7f7f7;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Monochrome</span>
                                        <small>Sophisticated grays</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="wine">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #4c1d95;"></div>
                                        <div class="color-swatch" style="background-color: #6b46c1;"></div>
                                        <div class="color-swatch" style="background-color: #581c87;"></div>
                                        <div class="color-swatch" style="background-color: #7c3aed;"></div>
                                        <div class="color-swatch" style="background-color: #faf5ff;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Wine</span>
                                        <small>Deep purples & burgundy</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="cream">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #fffacd;"></div>
                                        <div class="color-swatch" style="background-color: #ffefd5;"></div>
                                        <div class="color-swatch" style="background-color: #fff8dc;"></div>
                                        <div class="color-swatch" style="background-color: #ffdf00;"></div>
                                        <div class="color-swatch" style="background-color: #2d1810;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Cream</span>
                                        <small>Warm ivory & gold tones</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="pearl">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #ffffff;"></div>
                                        <div class="color-swatch" style="background-color: #f0f8ff;"></div>
                                        <div class="color-swatch" style="background-color: #f8f8ff;"></div>
                                        <div class="color-swatch" style="background-color: #00bfff;"></div>
                                        <div class="color-swatch" style="background-color: #2c2c2c;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Pearl</span>
                                        <small>Clean silver & whites</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="mint">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #f0ffff;"></div>
                                        <div class="color-swatch" style="background-color: #e0ffff;"></div>
                                        <div class="color-swatch" style="background-color: #f5fffa;"></div>
                                        <div class="color-swatch" style="background-color: #00ff00;"></div>
                                        <div class="color-swatch" style="background-color: #064e3b;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Mint</span>
                                        <small>Fresh light greens</small>
                                    </div>
                                </div>
                                <div class="palette-option" data-palette="blush">
                                    <div class="palette-preview">
                                        <div class="color-swatch" style="background-color: #fff0f5;"></div>
                                        <div class="color-swatch" style="background-color: #ffe4e1;"></div>
                                        <div class="color-swatch" style="background-color: #ffeef0;"></div>
                                        <div class="color-swatch" style="background-color: #ff1493;"></div>
                                        <div class="color-swatch" style="background-color: #4a1a1a;"></div>
                                    </div>
                                    <div class="palette-info">
                                        <span class="palette-name">Blush</span>
                                        <small>Soft pink & coral tones</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navigation-controls">
                    <button id="navigation-options" class="btn btn-secondary" aria-label="Navigation theme options" aria-expanded="false" aria-haspopup="true">
                        <i class="fas fa-compass"></i> Navigation
                    </button>
                    <div id="navigation-dropdown" class="dropdown navigation-dropdown" >
                        <div class="navigation-section">
                            <label>Navigation Themes:</label>
                            <div class="navigation-theme-grid">
                                <div class="theme-option" data-theme="modern">
                                    <div class="theme-preview">
                                        <div class="nav-demo modern-demo">
                                            <div class="demo-tab">NAV</div>
                                            <div class="demo-dock">
                                                <div class="demo-item"></div>
                                                <div class="demo-item"></div>
                                                <div class="demo-item"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <span class="theme-name">Modern</span>
                                        <small>Clean & contemporary</small>
                                    </div>
                                </div>
                                <div class="theme-option" data-theme="glass">
                                    <div class="theme-preview">
                                        <div class="nav-demo glass-demo">
                                            <div class="demo-tab">NAV</div>
                                            <div class="demo-dock">
                                                <div class="demo-item"></div>
                                                <div class="demo-item"></div>
                                                <div class="demo-item"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <span class="theme-name">Glass</span>
                                        <small>Translucent glass effect</small>
                                    </div>
                                </div>
                                <div class="theme-option" data-theme="minimal">
                                    <div class="theme-preview">
                                        <div class="nav-demo minimal-demo">
                                            <div class="demo-tab">NAV</div>
                                            <div class="demo-dock">
                                                <div class="demo-item"></div>
                                                <div class="demo-item"></div>
                                                <div class="demo-item"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="theme-info">
                                        <span class="theme-name">Minimal</span>
                                        <small>Simple & understated</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="toggle-live-preview" class="btn btn-secondary" aria-label="Toggle live mobile preview">
                    <i class="fas fa-mobile-alt"></i> Preview
                </button>
                <div class="publish-group">
                    <button id="view-published-menu" class="btn btn-secondary" aria-label="View your published menu">
                        <i class="fas fa-eye"></i> View Live Menu
                    </button>
                    <button id="publish-menu" class="btn btn-success" aria-label="Publish menu to make it live">
                        <i class="fas fa-share-alt"></i> Publish
                    </button>
                </div>
            </div>
            
            <!-- Contextual Tips Overlay -->
            <div id="contextual-tips" class="contextual-tips" >
                <div class="tip-content">
                    <div class="tip-arrow"></div>
                    <div class="tip-text">
                        <h4 class="tip-title">Tip</h4>
                        <p class="tip-description"></p>
                    </div>
                    <button class="tip-close" aria-label="Close tip">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <div class="main-content">
            <main id="menu-container" class="menu-container" role="main" aria-label="Menu editing workspace">
                <!-- Empty State for New Users -->
                <div id="empty-state" class="empty-state">
                    <div class="empty-state-content">
                        <div class="empty-state-icon">
                            <i class="fas fa-utensils"></i>
                        </div>
                        <h2>Ready to create your first menu?</h2>
                        <p>Get started by adding your first section, or use one of our quick-start templates</p>
                        
                        <div class="empty-state-actions">
                            <button id="add-first-section" class="btn btn-primary btn-large" aria-label="Add your first menu section">
                                <i class="fas fa-plus"></i> Add Your First Section
                            </button>
                            <button id="choose-template" class="btn btn-secondary btn-large" aria-label="Choose from pre-built menu templates">
                                <i class="fas fa-magic"></i> Use a Template
                            </button>
                        </div>
                        
                        <div class="quick-tips">
                            <p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Start with sections like "Appetizers", "Main Courses", or "Drinks"</p>
                        </div>
                    </div>
                </div>
                <!-- Menu sections will be dynamically added here -->
                <div aria-live="polite" aria-atomic="true" id="menu-changes-announcer" class="sr-only"></div>
            </main>

            <div id="side-preview-panel" class="side-preview-panel hidden">
                <div class="side-preview-controls">
                    <h3><i class="fas fa-mobile-alt"></i> Preview</h3>
                    <div>
                        <button id="refresh-side-preview" class="btn btn-primary btn-small" title="Refresh Preview">
                            <i class="fas fa-sync"></i>
                        </button>
                        <button id="close-side-preview" class="btn btn-secondary btn-small" aria-label="Close preview panel">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="side-preview-container">
                    <div class="smartphone-frame">
                        <div class="smartphone-screen" id="side-smartphone-screen">
                            <div class="smartphone-notch"></div>
                            <div class="smartphone-content">
                                <div id="side-preview-content" class="preview-content">
                                    <!-- Preview content will be generated here -->
                                </div>
                            </div>
                            <div id="preview-navigation" class="preview-navigation">
                                <div class="nav-tab" id="nav-tab">
                                    NAV
                                </div>
                                <div class="nav-dock-container" id="nav-dock-container">
                                    <!-- Dock navigation will be generated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div> <!-- Close main-layout -->

        <div id="preview-modal" class="modal" role="dialog" aria-labelledby="preview-modal-title" aria-modal="true">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="preview-modal-title">Mobile Menu Preview</h2>
                    <button class="close" aria-label="Close preview modal">&times;</button>
                </div>
                <div class="smartphone-frame">
                    <div class="smartphone-screen">
                        <div class="smartphone-notch"></div>
                        <div class="smartphone-content">
                            <div id="preview-content" class="preview-content">
                                <!-- Preview content will be generated here -->
                            </div>
                        </div>
                        <div id="modal-preview-navigation" class="preview-navigation">
                            <div class="nav-tab" id="modal-nav-tab">
                                <i class="fas fa-compass"></i> Navigate
                            </div>
                            <div class="nav-dock-container" id="modal-nav-dock-container">
                                <!-- Dock navigation will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="section-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Section Settings</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <label for="section-name">Section Name:</label>
                    <input type="text" id="section-name" placeholder="e.g., Appetizers, Beers, Wines">
                    
                    <label for="section-type">Section Type:</label>
                    <select id="section-type">
                        <option value="food">Food Items</option>
                        <option value="beer">Beer</option>
                        <option value="wine">Wine</option>
                        <option value="cocktails">Cocktails</option>
                        <option value="coffee">Coffee/Tea</option>
                        <option value="desserts">Desserts</option>
                        <option value="custom">Custom</option>
                    </select>
                    
                    <div id="custom-columns" >
                        <label>Custom Columns:</label>
                        <div id="column-builder">
                            <!-- Custom column builder will go here -->
                        </div>
                        <button type="button" id="add-custom-column" class="btn btn-small">Add Column</button>
                    </div>
                    
                    <div id="title-columns-section">
                        <label>Title Columns (shown prominently in preview):</label>
                        <div id="title-columns-list">
                            <!-- Title column checkboxes will be generated here -->
                        </div>
                        <p class="help-text">Select which columns should appear as the item title in the menu preview. Drag to reorder.</p>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="save-section" class="btn btn-primary">Save Section</button>
                        <button id="cancel-section" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="add-column-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-columns"></i> Add Column</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="column-options-section">
                        <label>Choose Column Type:</label>
                        
                        <div class="preset-columns">
                            <h3>Preset Columns:</h3>
                            <div class="preset-columns-grid">
                                <div class="preset-column-option" data-column="Item Name">
                                    <i class="fas fa-utensils"></i>
                                    <span>Item Name</span>
                                </div>
                                <div class="preset-column-option" data-column="Description">
                                    <i class="fas fa-align-left"></i>
                                    <span>Description</span>
                                </div>
                                <div class="preset-column-option" data-column="Price">
                                    <i class="fas fa-dollar-sign"></i>
                                    <span>Price</span>
                                </div>
                                <div class="preset-column-option" data-column="Category">
                                    <i class="fas fa-tags"></i>
                                    <span>Category</span>
                                </div>
                                <div class="preset-column-option" data-column="Ingredients">
                                    <i class="fas fa-list-ul"></i>
                                    <span>Ingredients</span>
                                </div>
                                <div class="preset-column-option" data-column="Allergens">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <span>Allergens</span>
                                </div>
                                <div class="preset-column-option" data-column="Calories">
                                    <i class="fas fa-fire"></i>
                                    <span>Calories</span>
                                </div>
                                <div class="preset-column-option" data-column="Prep Time">
                                    <i class="fas fa-clock"></i>
                                    <span>Prep Time</span>
                                </div>
                                <div class="preset-column-option" data-column="Spice Level">
                                    <i class="fas fa-pepper-hot"></i>
                                    <span>Spice Level</span>
                                </div>
                                <div class="preset-column-option" data-column="Dietary">
                                    <i class="fas fa-leaf"></i>
                                    <span>Dietary</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="custom-column-section">
                            <h3>Custom Column:</h3>
                            <div class="custom-column-input">
                                <input type="text" id="custom-column-name" placeholder="Enter custom column name">
                                <button type="button" id="add-custom-column-btn" class="btn btn-primary">
                                    <i class="fas fa-plus"></i> Add Custom
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="cancel-add-column" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="publish-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-share-alt"></i> Publish Your Menu</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="publish-step">
                        <label for="menu-url-path">Custom URL Path:</label>
                        <div class="url-input-group">
                            <span class="url-prefix">www.mymobilemenu.com/menu/</span>
                            <input type="text" id="menu-url-path" placeholder="my-restaurant-name" pattern="[a-z0-9-]+" title="Only lowercase letters, numbers, and dashes allowed">
                        </div>
                        <p class="help-text">Choose a unique path for your menu. Use only lowercase letters, numbers, and dashes.</p>
                        <div id="path-validation" class="validation-message"></div>
                    </div>

                    <div class="publish-step">
                        <label for="menu-title-publish">Menu Title:</label>
                        <input type="text" id="menu-title-publish" placeholder="Restaurant Name" value="Our Menu">
                        <p class="help-text">This will appear at the top of your published menu.</p>
                    </div>

                    <div class="publish-step">
                        <label for="menu-subtitle-publish">Menu Subtitle:</label>
                        <input type="text" id="menu-subtitle-publish" placeholder="Tagline or description" value="Crafted with care and passion">
                        <p class="help-text">Optional subtitle or tagline for your menu.</p>
                    </div>

                    <div class="publish-preview">
                        <h3>Preview URL:</h3>
                        <div class="preview-url">
                            <i class="fas fa-link"></i>
                            <span id="preview-url-display">https://www.mymobilemenu.com/menu/your-path-here</span>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button id="check-availability" class="btn btn-secondary">
                            <i class="fas fa-search"></i> Check Availability
                        </button>
                        <button id="publish-menu-confirm" class="btn btn-success" disabled>
                            <i class="fas fa-rocket"></i> Publish Menu
                        </button>
                        <button id="cancel-publish" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="success-modal" class="modal">
            <div class="modal-content success-modal-content">
                <div class="modal-header success-header">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h2 id="success-title">Success!</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body success-body">
                    <p id="success-message">Your menu has been updated successfully!</p>
                    
                    <div id="success-url-section" class="success-url-section" >
                        <label>Your menu is now live at:</label>
                        <div class="success-url">
                            <i class="fas fa-link"></i>
                            <span id="success-url-display"></span>
                            <button id="copy-success-url" class="btn btn-secondary btn-small" title="Copy URL">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="view-live-menu-from-success" class="btn btn-primary" >
                            <i class="fas fa-eye"></i> View Live Menu
                        </button>
                        <button id="close-success-modal" class="btn btn-secondary">
                            <i class="fas fa-check"></i> Got it
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="discard-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-exclamation-triangle"></i> Discard Changes</h2>
                    <span class="close">&times;</span>
                </div>
                <div class="modal-body">
                    <p>You have unsaved changes. What would you like to do?</p>
                    
                    <div class="discard-options">
                        <div class="discard-option">
                            <button id="revert-to-saved" class="btn btn-secondary btn-large">
                                <i class="fas fa-undo"></i>
                                <div class="button-content">
                                    <div class="button-title">Revert to Last Save</div>
                                    <div class="button-subtitle">Restore to your most recent saved version</div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="discard-option" id="revert-published-option" >
                            <button id="revert-to-published" class="btn btn-secondary btn-large">
                                <i class="fas fa-globe"></i>
                                <div class="button-content">
                                    <div class="button-title">Revert to Published Version</div>
                                    <div class="button-subtitle">Restore to the currently live menu</div>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button id="cancel-discard" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Welcome Onboarding Modal -->
        <div id="welcome-modal" class="modal welcome-modal">
            <div class="modal-content welcome-content">
                <div class="welcome-header">
                    <div class="welcome-logo">
                        <img src="Logos/logo_side_by_side.png" alt="MyMobileMenu" style="height: 40px;">
                    </div>
                    <h2>Welcome to MyMobileMenu!</h2>
                    <p class="welcome-subtitle">Create beautiful, professional menus in minutes</p>
                </div>
                
                <div class="welcome-body">
                    <div class="welcome-step active" data-step="1">
                        <div class="step-content">
                            <div class="step-icon">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <h3>Choose Your Starting Point</h3>
                            <p>Get started quickly with a pre-built template or create from scratch</p>
                            
                            <div class="template-options">
                                <div class="template-option" data-template="scratch">
                                    <div class="template-preview">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                    <div class="template-info">
                                        <h4>Start from Scratch</h4>
                                        <p>Build your menu from the ground up</p>
                                    </div>
                                </div>
                                
                                <div class="template-option" data-template="restaurant">
                                    <div class="template-preview">
                                        <i class="fas fa-utensils"></i>
                                    </div>
                                    <div class="template-info">
                                        <h4>Restaurant Menu</h4>
                                        <p>Appetizers, mains, desserts & drinks</p>
                                    </div>
                                </div>
                                
                                <div class="template-option" data-template="cafe">
                                    <div class="template-preview">
                                        <i class="fas fa-coffee"></i>
                                    </div>
                                    <div class="template-info">
                                        <h4>Cafe Menu</h4>
                                        <p>Coffee, pastries, sandwiches</p>
                                    </div>
                                </div>
                                
                                <div class="template-option" data-template="bar">
                                    <div class="template-preview">
                                        <i class="fas fa-wine-glass-alt"></i>
                                    </div>
                                    <div class="template-info">
                                        <h4>Bar Menu</h4>
                                        <p>Cocktails, beers, wines & bar food</p>
                                    </div>
                                </div>
                                
                                <div class="template-option" data-template="pizza">
                                    <div class="template-preview">
                                        <i class="fas fa-pizza-slice"></i>
                                    </div>
                                    <div class="template-info">
                                        <h4>Pizza Place</h4>
                                        <p>Pizzas, sides & beverages</p>
                                    </div>
                                </div>
                                
                                <div class="template-option" data-template="fine_dining">
                                    <div class="template-preview">
                                        <i class="fas fa-concierge-bell"></i>
                                    </div>
                                    <div class="template-info">
                                        <h4>Fine Dining</h4>
                                        <p>Elegant multi-course experience</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="welcome-step" data-step="2">
                        <div class="step-content">
                            <div class="step-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <h3>Customize Your Style</h3>
                            <p>Make your menu reflect your restaurant's personality</p>
                            
                            <div class="style-preview">
                                <div class="preview-phone">
                                    <div class="phone-screen" id="style-preview-screen">
                                        <div class="menu-preview">
                                            <div class="preview-header">
                                                <h4>Your Restaurant</h4>
                                            </div>
                                            <div class="preview-sections">
                                                <div class="preview-section">
                                                    <h5>Appetizers</h5>
                                                    <div class="preview-item">
                                                        <span>Sample Item</span>
                                                        <span>$12</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="style-options">
                                    <div class="style-option-group">
                                        <h4>Background</h4>
                                        <div class="background-previews">
                                            <div class="bg-option" data-bg="none">
                                                <div class="bg-preview solid-bg"></div>
                                                <span>Clean</span>
                                            </div>
                                            <div class="bg-option" data-bg="warm">
                                                <div class="bg-preview" style="background: linear-gradient(45deg, #f4e4c1, #e8d5b7);"></div>
                                                <span>Warm</span>
                                            </div>
                                            <div class="bg-option" data-bg="elegant">
                                                <div class="bg-preview" style="background: linear-gradient(45deg, #2c3e50, #34495e);"></div>
                                                <span>Elegant</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="style-option-group">
                                        <h4>Colors</h4>
                                        <div class="color-previews">
                                            <div class="color-option" data-palette="classic">
                                                <div class="color-swatches">
                                                    <div class="swatch" style="background: #2c3e50;"></div>
                                                    <div class="swatch" style="background: #27ae60;"></div>
                                                </div>
                                                <span>Classic</span>
                                            </div>
                                            <div class="color-option" data-palette="warm">
                                                <div class="color-swatches">
                                                    <div class="swatch" style="background: #e67e22;"></div>
                                                    <div class="swatch" style="background: #f39c12;"></div>
                                                </div>
                                                <span>Warm</span>
                                            </div>
                                            <div class="color-option" data-palette="ocean">
                                                <div class="color-swatches">
                                                    <div class="swatch" style="background: #3498db;"></div>
                                                    <div class="swatch" style="background: #2980b9;"></div>
                                                </div>
                                                <span>Ocean</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="welcome-step" data-step="3">
                        <div class="step-content">
                            <div class="step-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <h3>Quick Tips</h3>
                            <p>Here are the essentials to get you started:</p>
                            
                            <div class="tips-grid">
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-plus"></i>
                                    </div>
                                    <div class="tip-content">
                                        <h4>Adding Sections</h4>
                                        <p>Use "Add Section" to organize your menu (appetizers, mains, drinks, etc.)</p>
                                    </div>
                                </div>
                                
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <div class="tip-content">
                                        <h4>Live Preview</h4>
                                        <p>Click "Preview" to see how your menu looks on mobile devices</p>
                                    </div>
                                </div>
                                
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-save"></i>
                                    </div>
                                    <div class="tip-content">
                                        <h4>Auto-Save</h4>
                                        <p>Your work is automatically saved as you edit. Look for the save indicator.</p>
                                    </div>
                                </div>
                                
                                <div class="tip-item">
                                    <div class="tip-icon">
                                        <i class="fas fa-share-alt"></i>
                                    </div>
                                    <div class="tip-content">
                                        <h4>Publishing</h4>
                                        <p>When ready, click "Publish" to make your menu live and shareable</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="welcome-footer">
                    <div class="step-indicators">
                        <div class="step-indicator active" data-step="1"></div>
                        <div class="step-indicator" data-step="2"></div>
                        <div class="step-indicator" data-step="3"></div>
                    </div>
                    
                    <div class="welcome-actions">
                        <button id="welcome-skip" class="btn btn-secondary">
                            Skip Tour
                        </button>
                        <button id="welcome-back" class="btn btn-secondary" >
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button id="welcome-next" class="btn btn-primary">
                            Next <i class="fas fa-arrow-right"></i>
                        </button>
                        <button id="welcome-start" class="btn btn-primary" >
                            <i class="fas fa-rocket"></i> Start Creating!
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Skip to content link for accessibility -->
    <a href="#menu-container" class="skip-link">Skip to main content</a>
    <a href="#toolbar" class="skip-link">Skip to toolbar</a>
    <a href="#sidebar" class="skip-link">Skip to menu management</a>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal" >
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="auth-modal-title">Sign In</h2>
                <span class="close" onclick="const modal = document.getElementById('auth-modal'); modal.style.display='none'; modal.classList.remove('show');">&times;</span>
            </div>
            <div class="modal-body">
                <div id="auth-form-container">
                    <!-- Login Form -->
                    <div id="login-form" class="auth-form">
                        <div class="form-group">
                            <label for="login-email">Email:</label>
                            <input type="email" id="login-email" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="login-password">Password:</label>
                            <input type="password" id="login-password" placeholder="Enter your password" required>
                        </div>
                        <div id="login-error" class="error-message"></div>
                        <button id="login-btn" class="btn btn-primary" onclick="handleLogin()">Sign In</button>
                        
                        <div class="auth-divider">
                            <span>or</span>
                        </div>
                        
                        <div id="google-signin-button" class="google-signin-btn">
                            <i class="fab fa-google"></i>
                            Sign in with Google
                        </div>
                        
                        <p class="auth-switch">
                            Don't have an account? 
                            <a href="#" onclick="showRegisterForm()">Create one</a>
                        </p>
                    </div>

                    <!-- Register Form -->
                    <div id="register-form" class="auth-form" >
                        <div class="form-group">
                            <label for="register-name">Name:</label>
                            <input type="text" id="register-name" placeholder="Your name" required>
                        </div>
                        <div class="form-group">
                            <label for="register-email">Email:</label>
                            <input type="email" id="register-email" placeholder="Your email" required>
                        </div>
                        <div class="form-group">
                            <label for="register-restaurant">Restaurant Name (Optional):</label>
                            <input type="text" id="register-restaurant" placeholder="Your restaurant name">
                        </div>
                        <div class="form-group">
                            <label for="register-password">Password:</label>
                            <input type="password" id="register-password" placeholder="At least 8 characters" required>
                        </div>
                        <div id="register-error" class="error-message"></div>
                        <button id="register-btn" class="btn btn-primary" onclick="handleRegister()">Create Account</button>
                        
                        <div class="auth-divider">
                            <span>or</span>
                        </div>
                        
                        <div id="google-signup-button" class="google-signin-btn">
                            <i class="fab fa-google"></i>
                            Sign up with Google
                        </div>
                        
                        <p class="auth-switch">
                            Already have an account? 
                            <a href="#" onclick="showLoginForm()">Sign in</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="performance-utils.js?v=20250903"></script>
    <script src="ui-feedback.js?v=20250903"></script>
    <script src="ux-enhancements.js?v=20250903"></script>
    <script src="bulk-operations.js?v=20250903"></script>
    <script src="accessibility-enhancements.js?v=20250903"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        // Error handler to catch script loading issues
        window.addEventListener('error', function(e) {
            console.error('Script error detected:', e.message, 'at', e.filename + ':' + e.lineno + ':' + e.colno);
            console.error('Error object:', e.error);
        });
        
        // Log when scripts start loading
        console.log('Starting to load scripts...');
        
        // Google Sign-In configuration and handlers
        let GOOGLE_CLIENT_ID = null;
        let googleInitialized = false;
        
        async function loadGoogleConfig() {
            try {
                const response = await fetch('/api/config');
                if (response.ok) {
                    const config = await response.json();
                    GOOGLE_CLIENT_ID = config.googleClientId;
                    console.log('Google client ID loaded successfully from API');
                    return true;
                } else {
                    console.error('Failed to load Google config from API:', response.status);
                    // Fallback to hardcoded client ID for production
                    GOOGLE_CLIENT_ID = "911046669009-oevf7t3lhkui370ncavenvulu6fj8fu7.apps.googleusercontent.com";
                    console.log('Using fallback Google client ID');
                    return true;
                }
            } catch (error) {
                console.error('Error loading Google config from API:', error);
                // Fallback to hardcoded client ID
                GOOGLE_CLIENT_ID = "911046669009-oevf7t3lhkui370ncavenvulu6fj8fu7.apps.googleusercontent.com";
                console.log('Using fallback Google client ID due to network error');
                return true;
            }
        }
        
        async function initializeGoogle() {
            console.log('🚀 initializeGoogle called - Current state:', { 
                GOOGLE_CLIENT_ID: GOOGLE_CLIENT_ID ? 'loaded' : 'null',
                googleInitialized,
                googleAvailable: typeof google !== 'undefined'
            });
            
            // Load config if not already loaded
            if (!GOOGLE_CLIENT_ID) {
                console.log('📥 Loading Google config...');
                const configLoaded = await loadGoogleConfig();
                if (!configLoaded) {
                    console.log('❌ Config loading failed - retrying in 2 seconds');
                    setTimeout(initializeGoogle, 2000);
                    return;
                }
                console.log('✅ Google client ID loaded:', GOOGLE_CLIENT_ID);
            }
            
            if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
                try {
                    console.log('🔧 Attempting to initialize Google with client_id:', GOOGLE_CLIENT_ID);
                    google.accounts.id.initialize({
                        client_id: GOOGLE_CLIENT_ID,
                        callback: handleGoogleCredentialResponse,
                        auto_select: false,
                        cancel_on_tap_outside: true
                    });
                    googleInitialized = true;
                    console.log('✅ Google Sign-In initialized successfully');
                } catch (error) {
                    console.error('❌ Error initializing Google Sign-In:', error);
                }
            } else {
                console.error('⏳ Google Identity Services not loaded yet - retrying in 1 second');
                // Retry initialization after a delay
                setTimeout(initializeGoogle, 1000);
            }
        }
        
        function handleGoogleCredentialResponse(response) {
            console.log('Google credential response received');
            if (response.credential) {
                if (window.authManager && window.authManager.handleGoogleSignIn) {
                    window.authManager.handleGoogleSignIn(response.credential)
                        .then(result => {
                            if (result.success) {
                                console.log('Google sign-in successful');
                                const modal = document.getElementById('auth-modal'); 
                                modal.style.display = 'none'; 
                                modal.classList.remove('show');
                                location.reload(); // Refresh to show authenticated state
                            } else {
                                console.error('Google sign-in failed:', result.error);
                                const errorEl = document.getElementById('login-error') || document.getElementById('register-error');
                                if (errorEl) {
                                    errorEl.textContent = result.error || 'Google sign-in failed';
                                }
                            }
                        })
                        .catch(error => {
                            console.error('Google sign-in error:', error);
                            const errorEl = document.getElementById('login-error') || document.getElementById('register-error');
                            if (errorEl) {
                                errorEl.textContent = 'Google sign-in failed. Please try again.';
                            }
                        });
                } else {
                    console.error('Auth manager not available');
                }
            }
        }
        
        function triggerGoogleSignIn() {
            console.log('triggerGoogleSignIn called - googleInitialized:', googleInitialized, 'GOOGLE_CLIENT_ID:', GOOGLE_CLIENT_ID);
            
            if (!googleInitialized || !GOOGLE_CLIENT_ID) {
                console.error('Google Sign-In not ready - reinitializing...');
                // Try to initialize again
                initializeGoogle();
                return;
            }
            
            if (typeof google === 'undefined' || !google.accounts || !google.accounts.id) {
                console.error('Google Identity Services not available');
                return;
            }
            
            try {
                console.log('Triggering Google Sign-In prompt...');
                // Use the modern prompt method
                google.accounts.id.prompt((notification) => {
                    console.log('Google prompt notification:', notification);
                    if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
                        console.log('Google Sign-In prompt was not displayed or was skipped - trying renderButton fallback');
                        // Fallback to renderButton if prompt fails
                        const buttonContainer = document.createElement('div');
                        buttonContainer.style.display = 'none';
                        document.body.appendChild(buttonContainer);
                        
                        google.accounts.id.renderButton(buttonContainer, {
                            type: 'standard',
                            theme: 'outline',
                            size: 'large'
                        });
                        
                        // Programmatically click the rendered button
                        const googleBtn = buttonContainer.querySelector('div[role="button"]');
                        if (googleBtn) {
                            googleBtn.click();
                        }
                        
                        // Clean up
                        setTimeout(() => {
                            if (buttonContainer.parentNode) {
                                document.body.removeChild(buttonContainer);
                            }
                        }, 100);
                    }
                });
            } catch (error) {
                console.error('Error triggering Google sign-in:', error);
            }
        }
        
        // Initialize Google when the script loads
        window.addEventListener('load', function() {
            // Wait a bit for the Google script to fully load
            setTimeout(initializeGoogle, 1500);
        });
    </script>
    <script src="auth-db.js?v=20250903"></script>
    <script src="script.js?v=20250903"></script>
    <script>
        // Check if scripts loaded successfully
        setTimeout(function() {
            console.log('Script load check:');
            console.log('- window.authManager:', !!window.authManager);
            console.log('- window.menuEditor:', !!window.menuEditor);
            console.log('- MenuEditor class:', typeof MenuEditor);
            
            if (!window.menuEditor) {
                console.error('MenuEditor failed to initialize! Check for errors above.');
            }
            
            // Add click handlers for Google sign-in buttons
            const googleSigninBtn = document.getElementById('google-signin-button');
            const googleSignupBtn = document.getElementById('google-signup-button');
            
            if (googleSigninBtn) {
                googleSigninBtn.addEventListener('click', triggerGoogleSignIn);
                console.log('Google sign-in button handler added');
            }
            
            if (googleSignupBtn) {
                googleSignupBtn.addEventListener('click', triggerGoogleSignIn);
                console.log('Google sign-up button handler added');
            }
        }, 1000);
    </script>
</body>
</html>